<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>MangaNest</title>
<style>
body { font-family: system-ui; margin:0; background:#f4f4f4 }
header { background:#222; color:white; padding:10px; display:flex; gap:6px; flex-wrap:wrap }
header button { border:none; padding:6px 10px; border-radius:4px; cursor:pointer }
header button.active { background:#555 }
section { padding:15px }
.card { background:white; padding:12px; margin-bottom:12px; border-radius:6px; border:1px solid #ccc }
.row { display:flex; gap:12px; align-items:center; flex-wrap:wrap }
img.avatar { width:80px; height:80px; object-fit:cover; border-radius:6px }
.ok { background:#2e7d32; color:white }
</style>
</head>
<body>

<header id="menu"></header>
<section id="content"></section>

<script>
const DBKEY = "manganest-db";

let db = JSON.parse(localStorage.getItem(DBKEY)) || {
  currentUser: null,
  users: [
    { id: "simone", name: "Simone", color: "#4CAF50", avatar: "" },
    { id: "andrea", name: "Andrea", color: "#FFC107", avatar: "" }
  ],
  sagas: [],
  series: [],
  volumes: []
};

function save() {
  localStorage.setItem(DBKEY, JSON.stringify(db));
}

const sections = [
  "Home",
  "Aggiungi utente",
  "Database",
  "Aggiungi numeri",
  "Lettura",
  "Riordina volumi",
  "Edicola",
  "Backup"
];

let currentSection = "Home";

/* ---------- MENU ---------- */
function renderMenu() {
  const menu = document.getElementById("menu");
  menu.innerHTML = "";

  if (!db.currentUser) return;

  sections.forEach(sec => {
    const btn = document.createElement("button");
    btn.textContent = sec;
    if (sec === currentSection) btn.classList.add("active");
    btn.onclick = () => {
      currentSection = sec;
      render();
    };
    menu.appendChild(btn);
  });
}

/* ---------- RENDER ---------- */
function render() {
  renderMenu();
  const c = document.getElementById("content");
  c.innerHTML = "";

  if (!db.currentUser && currentSection !== "Home") {
    currentSection = "Home";
  }

  ({
    Home: renderHome,
    "Aggiungi utente": renderUsers,
    Database: renderDatabase,
    "Aggiungi numeri": placeholder,
    Lettura: placeholder,
    "Riordina volumi": placeholder,
    Edicola: placeholder,
    Backup: placeholder
  })[currentSection](c);
}

/* ---------- HOME ---------- */
function renderHome(c) {
  c.innerHTML = "<h2>Chi sta usando MangaNest?</h2>";

  db.users.forEach(u => {
    const card = document.createElement("div");
    card.className = "card row";
    card.innerHTML = `
      <img class="avatar" src="${u.avatar || "https://via.placeholder.com/80"}">
      <strong>${u.name}</strong>
      <button class="ok">Entra</button>
    `;
    card.querySelector("button").onclick = () => {
      db.currentUser = u.id;
      save();
      currentSection = "Database";
      render();
    };
    c.appendChild(card);
  });
}

/* ---------- AGGIUNGI UTENTE ---------- */
function renderUsers(c) {
  c.innerHTML = "<h2>Aggiungi / modifica utenti</h2>";

  db.users.forEach(u => {
    const d = document.createElement("div");
    d.className = "card row";
    d.innerHTML = `
      <input value="${u.name}">
      <input type="color" value="${u.color}">
      <input placeholder="Avatar URL" value="${u.avatar}">
    `;
    const [name, color, avatar] = d.children;

    name.onchange = () => { u.name = name.value; save(); };
    color.onchange = () => { u.color = color.value; save(); };
    avatar.onchange = () => { u.avatar = avatar.value; save(); };

    c.appendChild(d);
  });
}

/* ---------- PLACEHOLDER ---------- */
function renderDatabase(c) {
  c.innerHTML = "<p>Database – verrà completato nello step successivo.</p>";
}

function placeholder(c) {
  c.innerHTML = "<p>Sezione in costruzione.</p>";
}

render();
</script>
</body>
</html>

